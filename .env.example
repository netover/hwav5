# RESYNC v5.3.16 - Environment Configuration
# Copy this file to .env and fill in the values
# 
# SECURITY: Never commit .env files with real credentials to version control

# =============================================================================
# CRITICAL - MUST BE SET FOR PRODUCTION
# =============================================================================

# Environment (development, staging, production)
ENVIRONMENT=development

# JWT/Session Security (REQUIRED IN PRODUCTION)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=

# Admin Credentials (REQUIRED)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=

# =============================================================================
# DATABASE (REQUIRED)
# =============================================================================

# Full connection URL (preferred)
DATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/resync

# Or individual settings:
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_NAME=resync
DATABASE_USER=resync
DATABASE_PASSWORD=

# Connection Pool Settings
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
DATABASE_SSL_MODE=prefer

# =============================================================================
# TWS Integration
# =============================================================================

TWS_HOST=localhost
TWS_PORT=31111
TWS_USERNAME=
TWS_PASSWORD=
TWS_ENGINE_NAME=
TWS_ENGINE_OWNER=

# =============================================================================
# Redis (Optional - required for multi-worker deployments)
# =============================================================================

# Basic Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://localhost:6379
RESYNC_DISABLE_REDIS=false

# Connection Pool Settings
REDIS_POOL_MIN=5
REDIS_POOL_MAX=20
REDIS_SOCKET_TIMEOUT=5.0
REDIS_CONNECT_TIMEOUT=5.0
REDIS_HEALTH_INTERVAL=30

# =============================================================================
# Semantic Cache (v5.3.16) - LLM Response Caching
# =============================================================================
# Reduces API costs by 60-70% by caching semantically similar queries
# Requires: pip install sentence-transformers

# Cache threshold (0.1-0.5): Lower = more strict, fewer false positives
# Recommended: 0.25 for balanced performance
SEMANTIC_CACHE_THRESHOLD=0.25

# Default TTL in seconds (86400 = 24 hours)
SEMANTIC_CACHE_TTL=86400

# Maximum cache entries before LRU eviction
SEMANTIC_CACHE_MAX_ENTRIES=100000

# Embedding model (optional - uses all-MiniLM-L6-v2 by default)
# SEMANTIC_CACHE_EMBEDDING_MODEL=all-MiniLM-L6-v2

# =============================================================================
# AI/LLM Configuration
# =============================================================================

# OpenAI
OPENAI_API_KEY=

# Azure OpenAI
AZURE_OPENAI_API_KEY=
AZURE_API_KEY=

# Other providers (optional)
COHERE_API_KEY=
VOYAGE_API_KEY=
HUGGINGFACE_API_KEY=
NVIDIA_API_KEY=

# =============================================================================
# Observability (Optional)
# =============================================================================

# LangFuse
LANGFUSE_ENABLED=false
LANGFUSE_PUBLIC_KEY=
LANGFUSE_SECRET_KEY=
LANGFUSE_HOST=https://cloud.langfuse.com
LANGFUSE_SAMPLE_RATE=1.0

# Evidently AI Monitoring
EVIDENTLY_ENABLED=false
EVIDENTLY_REPORTS_DIR=./reports/evidently

# =============================================================================
# Application Settings
# =============================================================================

LOG_LEVEL=INFO

# Server Configuration
# WARNING: Use 127.0.0.1 in production behind a reverse proxy
SERVER_HOST=0.0.0.0
SERVER_PORT=8000

# Security
ENCRYPTION_KEY=
JWT_ALGORITHM=HS256

# Rate Limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# CORS (comma-separated list of allowed origins)
# Set to specific domains in production, e.g.: https://yourdomain.com,https://app.yourdomain.com
CORS_ALLOW_ORIGINS=*

# =============================================================================
# RAG Configuration
# =============================================================================

RAG_COLLECTION=default
RAG_USE_MOCK=false
RAG_UPLOAD_DIR=./uploads
RAG_SNAPSHOT_DIR=~/.resync/rag_snapshots

# Embedding
EMBEDDING_MODEL=text-embedding-ada-002
EMBEDDING_DIMENSION=1536
EMBEDDING_BATCH_SIZE=100

# HNSW Index Parameters
RAG_HNSW_M=16
RAG_HNSW_EF_CONSTRUCTION=64
RAG_EF_SEARCH_BASE=40
RAG_EF_SEARCH_MAX=200
RAG_MAX_TOPK=100
RAG_MAX_NEIGHBORS=50

# =============================================================================
# Backup Configuration
# =============================================================================

BACKUP_DIR=./backups

# =============================================================================
# Health Check Configuration
# =============================================================================

HEALTH_SANITIZE_CONNECTIONS=true
HEALTH_SANITIZE_PATHS=true
HEALTH_SANITIZE_SQL=true
HEALTH_LOG_FULL_ERRORS=false
HEALTH_INCLUDE_STACK_TRACES=false
HEALTH_ERROR_DETAIL_LEVEL=minimal
HEALTH_ERROR_ID_LENGTH=8

# =============================================================================
# RAG Cross-Encoder Reranking (v5.3.17)
# =============================================================================
# Enable cross-encoder for two-stage retrieval (recommended for production)
RAG_CROSS_ENCODER_ON=true

# Cross-encoder model (options: BAAI/bge-reranker-small, BAAI/bge-reranker-base)
# small: ~150MB RAM, good balance of speed/accuracy
# base: ~1.1GB RAM, better accuracy, slower
RAG_CROSS_ENCODER_MODEL=BAAI/bge-reranker-small

# Number of documents to return after reranking
RAG_CROSS_ENCODER_TOP_K=5

# Minimum score threshold (0-1) to keep documents
RAG_CROSS_ENCODER_THRESHOLD=0.3
