<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Status | Resync v5.3</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style-neumorphic.css">
</head>
<body>
    <div class="app-container">
        <!-- HEADER COM NAVEGAÇÃO HORIZONTAL -->
        <header class="header-card">
            <div class="brand-section">
                <div class="brand-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="brand-text">Resync</div>
                <div class="version-badge">v5.3.0</div>
            </div>
            <nav class="nav-buttons">
                <a href="/" class="nav-button">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="/tws-monitor" class="nav-button">
                    <i class="fas fa-chart-line"></i> TWS Monitor
                </a>
                <a href="/admin" class="nav-button">
                    <i class="fas fa-cog"></i> Admin
                </a>
                <a href="/monitoring" class="nav-button primary">
                    <i class="fas fa-heartbeat"></i> Health
                </a>
            </nav>
        </header>

        <!-- TOOLBAR -->
        <div class="toolbar-card">
            <nav class="breadcrumb">
                <div class="breadcrumb-item">
                    <a href="/"><i class="fas fa-home"></i></a>
                </div>
                <div class="breadcrumb-separator">/</div>
                <div class="breadcrumb-item active">
                    <span>System Health</span>
                </div>
            </nav>
            <div class="toolbar-actions">
                <button class="toolbar-btn" id="refreshHealth" title="Atualizar">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="toolbar-btn" id="toggleTheme" title="Modo Escuro">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>

        <main>
            <!-- HEALTH STATUS PRINCIPAL -->
            <section class="card" style="text-align: center;">
                <div class="status-icon success" id="main-health-icon" style="width: 80px; height: 80px; font-size: 36px; margin: 0 auto var(--space-lg);">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <h1 class="health-status" id="health-status" style="font-size: 2.5rem; color: var(--status-success); margin-bottom: var(--space-sm);">Healthy</h1>
                <p style="color: var(--text-muted); font-size: 1.1rem;">Resync TWS Integration System</p>
            </section>

            <!-- MÉTRICAS DE SAÚDE -->
            <section class="card">
                <h2><i class="fas fa-chart-bar" style="color: var(--brand-primary);"></i> Métricas do Sistema</h2>
                <div class="dashboard-grid">
                    <div class="status-card">
                        <div class="status-icon success" id="server-icon">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="status-value" id="server-status">Running</div>
                        <div class="status-label">Server Status</div>
                    </div>
                    <div class="status-card">
                        <div class="status-icon success" id="db-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div class="status-value" id="db-status">Connected</div>
                        <div class="status-label">Database</div>
                    </div>
                    <div class="status-card">
                        <div class="status-icon warning" id="tws-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                        <div class="status-value" id="tws-status">Checking...</div>
                        <div class="status-label">TWS Connection</div>
                    </div>
                    <div class="status-card">
                        <div class="status-icon success" id="redis-icon">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="status-value" id="redis-status">Connected</div>
                        <div class="status-label">Redis Cache</div>
                    </div>
                </div>
            </section>

            <!-- DETALHES ADICIONAIS -->
            <section class="card">
                <h2><i class="fas fa-info-circle" style="color: var(--brand-primary);"></i> Detalhes</h2>
                <div class="jobs-table">
                    <div class="table-row" style="grid-template-columns: 1fr 1fr;">
                        <div class="job-name"><i class="fas fa-plug"></i> WebSocket</div>
                        <div><span class="status-badge status-success" id="ws-badge">Ready</span></div>
                    </div>
                    <div class="table-row" style="grid-template-columns: 1fr 1fr;">
                        <div class="job-name"><i class="fas fa-clock"></i> Uptime</div>
                        <div style="font-family: 'JetBrains Mono', monospace; color: var(--brand-primary); font-weight: 600;" id="uptime">00:00:00</div>
                    </div>
                    <div class="table-row" style="grid-template-columns: 1fr 1fr;">
                        <div class="job-name"><i class="fas fa-calendar-check"></i> Última Verificação</div>
                        <div style="color: var(--text-secondary);" id="timestamp">Loading...</div>
                    </div>
                    <div class="table-row" style="grid-template-columns: 1fr 1fr;">
                        <div class="job-name"><i class="fas fa-code-branch"></i> Versão</div>
                        <div style="color: var(--brand-primary); font-weight: 600;">v5.3.0</div>
                    </div>
                    <div class="table-row" style="grid-template-columns: 1fr 1fr;">
                        <div class="job-name"><i class="fas fa-microchip"></i> API Status</div>
                        <div><span class="status-badge status-success" id="api-badge">Online</span></div>
                    </div>
                </div>
            </section>

            <!-- LINKS RÁPIDOS -->
            <section class="card">
                <h2><i class="fas fa-link" style="color: var(--brand-primary);"></i> Navegação</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--space-md);">
                    <a href="/" class="btn btn-outline">
                        <i class="fas fa-home text-info"></i> Dashboard
                    </a>
                    <a href="/tws-monitor" class="btn btn-outline">
                        <i class="fas fa-chart-line text-success"></i> TWS Monitor
                    </a>
                    <a href="/revisao" class="btn btn-outline">
                        <i class="fas fa-clipboard-check text-warning"></i> Revisão
                    </a>
                    <a href="/admin" class="btn btn-outline">
                        <i class="fas fa-cogs text-danger"></i> Admin
                    </a>
                </div>
            </section>
        </main>

        <footer>
            <p><i class="fas fa-robot"></i> Resync v5.3.0 &copy; 2025 - Monitoramento Inteligente para HCL Workload Automation</p>
        </footer>
    </div>

    <script>
        // Theme Toggle
        document.getElementById('toggleTheme')?.addEventListener('click', function() {
            const body = document.body;
            const icon = this.querySelector('i');
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
            }
        });

        // Refresh button
        document.getElementById('refreshHealth')?.addEventListener('click', function() {
            this.querySelector('i').classList.add('fa-spin');
            checkHealth();
            setTimeout(() => {
                this.querySelector('i').classList.remove('fa-spin');
            }, 1000);
        });

        // Auto-refresh health status
        let uptime = 0;
        
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').textContent = now.toLocaleString('pt-BR');
        }
        
        function updateUptime() {
            uptime++;
            const hours = Math.floor(uptime / 3600);
            const minutes = Math.floor((uptime % 3600) / 60);
            const seconds = uptime % 60;
            document.getElementById('uptime').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function setStatusIcon(elementId, status) {
            const icon = document.getElementById(elementId);
            if (icon) {
                icon.classList.remove('success', 'warning', 'error', 'info');
                icon.classList.add(status);
            }
        }

        function setBadgeStatus(elementId, status, text) {
            const badge = document.getElementById(elementId);
            if (badge) {
                badge.textContent = text;
                badge.classList.remove('status-success', 'status-warning', 'status-error', 'status-info');
                badge.classList.add(`status-${status}`);
            }
        }
        
        function checkHealth() {
            fetch('/api/v1/status')
                .then(response => response.json())
                .then(data => {
                    const healthElement = document.getElementById('health-status');
                    const mainIcon = document.getElementById('main-health-icon');
                    
                    healthElement.textContent = 'Healthy';
                    healthElement.style.color = 'var(--status-success)';
                    mainIcon.classList.remove('warning', 'error');
                    mainIcon.classList.add('success');
                    
                    setBadgeStatus('api-badge', 'success', 'Online');
                    updateTimestamp();
                })
                .catch(error => {
                    console.error('Health check failed:', error);
                    const healthElement = document.getElementById('health-status');
                    const mainIcon = document.getElementById('main-health-icon');
                    
                    healthElement.textContent = 'Error';
                    healthElement.style.color = 'var(--status-error)';
                    mainIcon.classList.remove('success', 'warning');
                    mainIcon.classList.add('error');
                    
                    setBadgeStatus('api-badge', 'error', 'Offline');
                    updateTimestamp();
                });
        }
        
        function checkWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const testSocket = new WebSocket(`${protocol}//${window.location.host}/api/v1/ws/test-agent`);
            
            testSocket.onopen = function() {
                setBadgeStatus('ws-badge', 'success', 'Ready');
                testSocket.close();
            };
            
            testSocket.onerror = function() {
                setBadgeStatus('ws-badge', 'error', 'Error');
            };
            
            testSocket.onclose = function() {
                const badge = document.getElementById('ws-badge');
                if (badge && badge.textContent !== 'Ready') {
                    setBadgeStatus('ws-badge', 'warning', 'Closed');
                }
            };
        }

        // Animate cards on load
        document.addEventListener('DOMContentLoaded', function() {
            const statusCards = document.querySelectorAll('.status-card');
            statusCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
        
        // Initialize
        updateTimestamp();
        updateUptime();
        checkHealth();
        checkWebSocket();
        
        // Update uptime every second
        setInterval(updateUptime, 1000);
        
        // Check health every 30 seconds
        setInterval(checkHealth, 30000);
        
        // Check WebSocket every 60 seconds
        setInterval(checkWebSocket, 60000);
    </script>
</body>
</html>
